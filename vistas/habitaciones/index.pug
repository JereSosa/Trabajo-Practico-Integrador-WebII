extends ../layout

block contenido
  header.flex.items-center.justify-between.px-6.py-4.bg-gray-800.shadow-md.mb-8
    button#menu-btn.text-3xl.text-white(type="button")
      i.fas.fa-bars
    h1.text-3xl.font-bold.text-white Gestión de Habitaciones
    span

  main.px-6
    div(class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10")
      each ala in alas
        section.bg-white.rounded-2xl.shadow-2xl.p-6.flex.flex-col.gap-6
          h2.text-2xl.font-extrabold.mb-2.text-blue-900 #{ala.nombre}

          if ala.habitaciones.length > 0
            each habitacion in ala.habitaciones
              .habitacion.flex.flex-col.gap-2.bg-gradient-to-r.from-gray-100.to-gray-300.rounded-xl.p-4.shadow
                .flex.items-center.mb-1
                  h3.text-lg.font-bold.text-gray-800.flex-1 #{habitacion.nombre}
                  button.add-cama-btn(
                    type="button",
                    data-hab=habitacion.id,
                    class="bg-blue-300 text-blue-900 text-sm font-bold px-2 py-1 rounded shadow hover:bg-blue-400"
                    ) + Agregar Cama
                
                each cama in habitacion.camas
                    .cama-card.flex.flex-col.items-center.justify-center.w-24.h-24.rounded-xl.shadow-xl.cursor-pointer.relative.transition(
                        class=(cama.estado === 'ocupada' ? 'bg-red-400 hover:scale-105' : 'bg-green-400 hover:scale-105')
                        data-id=cama.id
                        data-estado=cama.estado
                        data-hab=habitacion.id
                    )
                        span.font-bold.text-lg #{cama.id}
                        if cama.estado === 'ocupada'
                            i.fas.fa-bed.text-2xl.my-1
                            span.text-xs.font-semibold Ocupada
                        else
                            i.fas.fa-plus.text-2xl.my-1
                            span.text-xs.font-semibold Libre
          else
            .text-center.text-gray-600 No hay habitaciones creadas todavía.
            button.add-habitacion-btn.bg-indigo-400.text-white.rounded.px-2.py-1.shadow.mt-2(
              type="button",
              data-ala=ala.id
            ) + Crear Habitación

  // Scripts JS para botones
  script.
    document.querySelectorAll('.add-cama-btn').forEach(btn => {
      btn.addEventListener('click', async (e) => {
        const habitacion_id = e.target.getAttribute('data-hab');
        
        const response = await fetch('/camas', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ habitacion_id })
        });

        if(response.ok){
          alert("Cama agregada correctamente");
          location.reload();
        } else {
          alert("Error al agregar cama");
        }
      });
    });

    document.querySelectorAll('.add-habitacion-btn').forEach(btn => {
      btn.addEventListener('click', async (e) => {
        const ala_id = e.target.getAttribute('data-ala');
        const nombre = prompt("Ingresa el nombre de la habitación:");
        
        if (!nombre) return;

        const response = await fetch('/habitaciones', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ ala_id, nombre })
        });

        if(response.ok){
          alert("Habitación creada correctamente");
          location.reload();
        } else {
          alert("Error al crear habitación");
        }
      });
    });


