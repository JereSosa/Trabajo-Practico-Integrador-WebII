doctype html
html(lang="es")
  head
    meta(http-equiv="Content-Type" content="text/html; charset=UTF-8")
    meta(charset="UTF-8")
    meta(name="viewport" content="width=device-width, initial-scale=1.0")
    title Sistema HIS
    link(rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css")
    link(rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css")
    link(rel="preconnect" href="https://fonts.googleapis.com")
    link(rel="preconnect" href="https://fonts.gstatic.com" crossorigin)
    link(rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap")
    style.
      body { font-family: 'Poppins', sans-serif; }

  body(class="min-h-screen bg-gradient-to-r from-gray-900 via-gray-800 to-gray-700 text-white relative overflow-x-hidden")

    //– ICONO LOGIN –//
    div(class="absolute top-0 right-0 mr-2 mt-0")
      button#login-toggle(type="button" class="flex items-center space-x-2 focus:outline-none")
        span.font-semibold.text-white Ingresar
        i(class="fas fa-user-circle text-white text-3xl")

    //– MENSAJES DE ÉXITO Y ERROR –//
    if success || error
      div(id="alerta-mensaje" class="fixed top-5 left-1/2 transform -translate-x-1/2 z-50" style="min-width:400px")
        if success == 'staff'
          div(class="bg-green-600 text-white font-bold py-2 px-6 rounded shadow-lg animate-bounce") ¡Registro de staff exitoso!
        else if success == 'paciente'
          div(class="bg-green-600 text-white font-bold py-2 px-6 rounded shadow-lg animate-bounce") ¡Registro de paciente exitoso!
        if error == 'usuario_existente'
          div(class="bg-red-600 text-white font-bold py-2 px-6 rounded shadow-lg") Usuario o email ya registrado.
        else if error == 'codigo'
          div(class="bg-red-600 text-white font-bold py-2 px-6 rounded shadow-lg") Código de registro incorrecto.
        else if error
          div(class="bg-red-600 text-white font-bold py-2 px-6 rounded shadow-lg") #{error}


    //– MODAL LOGIN –//
    div#login-modal(class="fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center hidden")
      div(class="bg-white rounded-lg w-96 p-6 relative z-60 text-gray-900")
        button#login-close(type="button" class="absolute top-2 right-2 text-gray-500 hover:text-gray-700")
          i(class="fas fa-times")
        div(class="flex border-b mb-4")
          button#tab-paciente(type="button" class="flex-1 py-2 text-center border-b-2 border-blue-500 font-semibold") Paciente
          button#tab-staff(type="button" class="flex-1 py-2 text-center text-gray-600") Staff Médico

        //– Formulario Paciente –//
        form#form-paciente(action="/login/paciente" method="post" class="space-y-4")
          label.block.mb-1 Email:
          input(type="email" name="email" required class="w-full border p-2 rounded")
          label.block.mb-1 Contraseña:
          input(type="password" name="password" required class="w-full border p-2 rounded")
          button(type="submit" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 rounded") Entrar como Paciente
          div.text-center.mt-2
            a#enlace-registro-paciente(href="#" class="text-blue-600 hover:underline cursor-pointer") ¿Eres nuevo? Registrate

        //– Formulario Staff –//
        form#form-staff(action="/login/staff" method="post" class="space-y-4 hidden")
          label.block.mb-1 Usuario:
          input(type="text" name="usuario" required class="w-full border p-2 rounded")
          label.block.mb-1 Contraseña:
          input(type="password" name="password" required class="w-full border p-2 rounded")
          button(type="submit" class="w-full bg-green-500 hover:bg-green-600 text-white font-semibold py-2 rounded") Entrar como Staff Médico
          div.text-center.mt-2
            a#enlace-registro-staff(href="#" class="text-blue-600 hover:underline cursor-pointer") ¿Eres médico nuevo? Registrarme

    //– MODAL REGISTRO STAFF –//
    div#registro-staff-modal(class="fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center hidden")
      div(class="bg-white rounded-lg w-96 p-6 relative z-60 text-gray-900")
        button#registro-staff-close(type="button" class="absolute top-2 right-2 text-gray-500 hover:text-gray-700")
          i(class="fas fa-times")
        h2.text-2xl.font-bold.mb-4.text-blue-700 Registro Staff Médico
        form(action="/registro-staff" method="post" class="space-y-4")
          label.block.mb-1 Nombre:
          input(type="text" name="nombre" required class="w-full border p-2 rounded")
          label.block.mb-1 Usuario:
          input(type="text" name="usuario" required class="w-full border p-2 rounded")
          label.block.mb-1 Email:
          input(type="email" name="email" required class="w-full border p-2 rounded")
          label.block.mb-1 Contraseña:
          input(type="password" name="password" required class="w-full border p-2 rounded")
          label.block.mb-1 Especialidad:
          input(type="text" name="especialidad" class="w-full border p-2 rounded")
          label.block.mb-1 Código de registro:
          input(type="password" name="codigo_registro" required class="w-full border p-2 rounded")
          button(type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 rounded") Registrarme

    //– MODAL REGISTRO PACIENTE –//
    div#registro-paciente-modal(class="fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center hidden")
      div(class="bg-white rounded-lg w-96 p-6 relative z-60 text-gray-900")
        button#registro-paciente-close(type="button" class="absolute top-2 right-2 text-gray-500 hover:text-gray-700")
          i(class="fas fa-times")
        h2.text-2xl.font-bold.mb-4.text-blue-700 Registro de Paciente
        form(action="/registro-paciente" method="post" class="space-y-4")
          label.block.mb-1 Nombre:
          input(type="text" name="nombre" required class="w-full border p-2 rounded")
          label.block.mb-1 Email:
          input(type="email" name="email" required class="w-full border p-2 rounded")
          label.block.mb-1 Contraseña:
          input(type="password" name="password" required class="w-full border p-2 rounded")
          label.block.mb-1 Teléfono:
          input(type="text" name="telefono" required class="w-full border p-2 rounded")
          label.block.mb-1 Sexo:
          select(name="sexo" required class="w-full border p-2 rounded")
            option(value="" disabled selected) Selecciona...
            option(value="M") Masculino
            option(value="F") Femenino
          button(type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 rounded") Registrarme

    block contenido

    script.
      document.addEventListener('DOMContentLoaded', function(){
        // Referencias
        const toggle      = document.getElementById('login-toggle');
        const modal       = document.getElementById('login-modal');
        const closeBtn    = document.getElementById('login-close');
        const tabPac      = document.getElementById('tab-paciente');
        const tabStaff    = document.getElementById('tab-staff');
        const formPac     = document.getElementById('form-paciente');
        const formStaff   = document.getElementById('form-staff');

        const registroStaffModal = document.getElementById('registro-staff-modal');
        const registroStaffClose = document.getElementById('registro-staff-close');
        const enlaceRegStaff     = document.getElementById('enlace-registro-staff');
        const enlaceRegPaciente  = document.getElementById('enlace-registro-paciente');

        // Login modal
        toggle.addEventListener('click', e => {
          e.stopPropagation();
          modal.classList.remove('hidden');
        });
        closeBtn.addEventListener('click', () => modal.classList.add('hidden'));
        modal.addEventListener('click', e => {
          if (e.target === modal) modal.classList.add('hidden');
        });

        // Tabs
        tabPac.addEventListener('click', () => {
          tabPac.classList.add('border-blue-500','font-semibold'); tabPac.classList.remove('text-gray-600');
          tabStaff.classList.remove('border-blue-500','font-semibold'); tabStaff.classList.add('text-gray-600');
          formPac.classList.remove('hidden'); formStaff.classList.add('hidden');
        });
        tabStaff.addEventListener('click', () => {
          tabStaff.classList.add('border-blue-500','font-semibold'); tabStaff.classList.remove('text-gray-600');
          tabPac.classList.remove('border-blue-500','font-semibold'); tabPac.classList.add('text-gray-600');
          formStaff.classList.remove('hidden'); formPac.classList.add('hidden');
        });

        // REGISTRO STAFF MODAL
        enlaceRegStaff.addEventListener('click', e => {
          e.preventDefault();
          registroStaffModal.classList.remove('hidden');
        });
        registroStaffClose.addEventListener('click', () => registroStaffModal.classList.add('hidden'));
        registroStaffModal.addEventListener('click', e => {
          if (e.target === registroStaffModal) registroStaffModal.classList.add('hidden');
        });

        // REGISTRO PACIENTE MODAL
        enlaceRegPaciente.addEventListener('click', e => {
          e.preventDefault();
          document.getElementById('registro-paciente-modal').classList.remove('hidden');
        });
        document.getElementById('registro-paciente-close').addEventListener('click', () => {
          document.getElementById('registro-paciente-modal').classList.add('hidden');
        });
        document.getElementById('registro-paciente-modal').addEventListener('click', e => {
          if (e.target === document.getElementById('registro-paciente-modal'))
            document.getElementById('registro-paciente-modal').classList.add('hidden');
        });

        // Ocultar mensajes de éxito/error tras 3 segundos
        setTimeout(() => {
          const msg = document.querySelector('.fixed.top-5.left-1\\/2');
          if(msg) msg.style.display = 'none';
        }, 3000);

      });
